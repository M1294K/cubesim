<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Interactive Cube Simulator</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background-color: #f0f2f5;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    color: #333;
  }
  .main-container {
    display: flex;
    align-items: center;
    gap: 40px;
    background-color: #ffffff;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.07);
  }
  .cube-3d-container {
    text-align: center;
  }
  h1 {
    margin-top: 0;
    font-size: 24px;
    font-weight: 600;
  }
  #cube_container {
    width: 400px;
    height: 400px;
    margin: 20px auto;
    border-radius: 8px;
    overflow: hidden;
  }
  .controls {
    margin-bottom: 20px;
  }
  button {
    background-color: #007aff;
    color: white;
    border: none;
    padding: 12px 24px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    font-weight: 500;
    margin: 4px 2px;
    cursor: pointer;
    border-radius: 8px;
    transition: background-color 0.2s ease-in-out, transform 0.1s ease;
  }
  button:hover {
    background-color: #005ecb;
  }
  button:active {
    transform: scale(0.98);
  }
  #reset-btn {
    background-color: #f44336;
  }
  #reset-btn:hover {
    background-color: #d32f2f;
  }
  .instructions {
    text-align: left;
    display: inline-block;
    background-color: #f0f2f5;
    padding: 15px;
    border-radius: 8px;
    font-size: 14px;
  }
  .instructions p {
    margin: 5px 0;
  }
  .instructions b {
    font-weight: 600;
  }
  
  /* 2D Net Styles */
  .net-container {
    display: grid;
    grid-template-columns: repeat(4, 100px);
    grid-template-rows: repeat(3, 100px);
    gap: 2px;
    width: 406px;
    height: 304px;
  }
  .face {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    gap: 2px;
    width: 100px;
    height: 100px;
    background-color: #1c1c1e;
    border: 1px solid #444;
    border-radius: 4px;
    padding: 2px;
    box-sizing: border-box;
  }
  .sticker {
    width: 100%;
    height: 100%;
    border-radius: 2px;
  }
  .face-U { grid-area: 1 / 2 / 2 / 3; }
  .face-L { grid-area: 2 / 1 / 3 / 2; }
  .face-F { grid-area: 2 / 2 / 3 / 3; }
  .face-R { grid-area: 2 / 3 / 3 / 4; }
  .face-B { grid-area: 2 / 4 / 3 / 5; }
  .face-D { grid-area: 3 / 2 / 4 / 3; }
</style>
<!-- Prepare acjs arrays to capture cube internals -->
<script>
  var acjs_move = [];
  var acjs_startAnimation = [];
  var acjs_stopAnimation = [];
  var acjs_cube = [];
  var acjs_scube = [];
  var acjs_initialCube = [];
  var acjs_initialSCube = [];
  var acjs_paint = [];
  var acjs_clear = [];
  var acjs_twisting = [];
  var acjs_animating = [];
  var acjs_movePos = [];
  var acjs_curMove = [];
  var acjs_natural = [];
  var acjs_initialEye = [];
  var acjs_initialEyeX = [];
  var acjs_initialEyeY = [];
  var acjs_eye = [];
  var acjs_eyeX = [];
  var acjs_eyeY = [];
  var acjs_colors = [];
</script>
<script src="AnimCube3.js"></script>
</head>
<body>

<div class="main-container">
  <div class="net-container" id="net_container"></div>
  <div class="cube-3d-container">
    <h1>Interactive Cube Simulator</h1>
    <div id="cube_container"></div>
    <div class="controls">
      <button id="scramble-btn">Scramble</button>
      <button id="reset-btn">Reset</button>
    </div>
    <div class="instructions" style="display: none;">
      <p><b>Keyboard Controls:</b></p>
      <p><b>U/u, R/r, F/f, D/d, L/l, B/b</b></p>
      <p>Lowercase for clockwise, Uppercase (Shift + key) for counter-clockwise.</p>
    </div>
  </div>
</div>

<script>
// ID for our cube instance
var CUBE_ID = 'cube_container';

var cube = new AnimCube3('id=' + CUBE_ID + '&initmove=x2z-1&speed=1&buttonbar=0&counter=0');

// --- 2D Net Logic ---
var netContainer = document.getElementById('net_container');
var faceLayout = {
    'U': { gridArea: '1 / 2 / 2 / 3' },
    'L': { gridArea: '2 / 1 / 3 / 2' },
    'F': { gridArea: '2 / 2 / 3 / 3' },
    'R': { gridArea: '2 / 3 / 3 / 4' },
    'B': { gridArea: '2 / 4 / 3 / 5' },
    'D': { gridArea: '3 / 2 / 4 / 3' }
};
var faceRotations = { // Rotations to align net correctly
    'U': 'rotate(90deg)',
    'D': 'rotate(180deg)',
    'F': 'rotate(90deg)',
    'B': 'rotate(90deg)',
    'L': 'rotate(90deg)',
    'R': 'rotate(180deg)'
};
var netInitialized = false;
var stickerElements = []; // To store references to the sticker divs

function drawNet() {
    var cubeState = acjs_cube[CUBE_ID]; // Using the orientation-dependent state
    var colorPalette = acjs_colors[CUBE_ID];
    if (!cubeState || !colorPalette || colorPalette.length === 0) return;

    // --- Build net structure once ---
    if (!netInitialized) {
        netContainer.innerHTML = ''; 
        stickerElements = []; 

        var faceMap = { U: 0, D: 1, F: 2, B: 3, L: 4, R: 5 };

        Object.keys(faceLayout).forEach(function(faceName) {
            var faceIndex = faceMap[faceName];
            
            var faceDiv = document.createElement('div');
            faceDiv.className = 'face face-' + faceName;
            faceDiv.style.gridArea = faceLayout[faceName].gridArea;
            if (faceRotations[faceName]) {
                faceDiv.style.transform = faceRotations[faceName];
            }

            var faceStickers = [];
            for (var i = 0; i < 9; i++) {
                var stickerDiv = document.createElement('div');
                stickerDiv.className = 'sticker';
                faceStickers.push(stickerDiv);
                faceDiv.appendChild(stickerDiv);
            }
            stickerElements[faceIndex] = faceStickers;
            netContainer.appendChild(faceDiv);
        });
        netInitialized = true;
    }

    // --- Update colors on every frame ---
    for (var faceIdx = 0; faceIdx < 6; faceIdx++) {
        for (var stickerIdx = 0; stickerIdx < 9; stickerIdx++) {
            if (stickerElements[faceIdx] && stickerElements[faceIdx][stickerIdx]) {
                var colorIndex = cubeState[faceIdx][stickerIdx]; // Reading from oriented state
                if (colorIndex < colorPalette.length) {
                    stickerElements[faceIdx][stickerIdx].style.backgroundColor = colorPalette[colorIndex];
                }
            }
        }
    }
}

// --- Main loop to redraw net ---
setInterval(drawNet, 50);

// --- Helper functions using the captured internals ---
function performMoves(moveStr) {
  if (acjs_animating[CUBE_ID]) return;
  var moves = moveStr.split(' ');
  
  if (typeof acjs_move[CUBE_ID][acjs_curMove[CUBE_ID]] === 'undefined') {
    acjs_move[CUBE_ID][acjs_curMove[CUBE_ID]] = [];
  }
  var currentMoveSeq = acjs_move[CUBE_ID][acjs_curMove[CUBE_ID]];
  
  for (var i = 0; i < moves.length; i++) {
    var move = moves[i];
    if (move === '') continue;
    
    var moveChar = move.charAt(0);
    var isInverse = move.length > 1 && move.charAt(1) === "'";
    var faceMoveCode = "UDFBLR".indexOf(moveChar);
    var bodyMoveCode = "xyz".indexOf(moveChar);
    
    if (faceMoveCode !== -1) {
        var modifier = isInverse ? 2 : 0;
        currentMoveSeq.push(24 * faceMoveCode + modifier);
    } else if (bodyMoveCode !== -1) {
        var moveCodeValue;
        if (moveChar === 'y') { moveCodeValue = 56; } 
        else if (moveChar === 'x') { moveCodeValue = 32; } 
        else if (moveChar === 'z') { moveCodeValue = 104; }
        
        if (moveCodeValue) {
            var modifier = isInverse ? 2 : 0;
            currentMoveSeq.push(moveCodeValue + modifier);
        }
    }
  }
  
  acjs_startAnimation[CUBE_ID](-1);
}

function resetCube() {
  if (acjs_clear[CUBE_ID]) {
    acjs_clear[CUBE_ID]();
    netInitialized = false; // Reset the net so it can be rebuilt
    if (acjs_move[CUBE_ID] && typeof acjs_move[CUBE_ID][acjs_curMove[CUBE_ID]] !== 'undefined') {
      acjs_move[CUBE_ID][acjs_curMove[CUBE_ID]] = [];
    }
  }
}

function scrambleCube() {
  if (acjs_animating[CUBE_ID]) return;
  var faces = ["U", "D", "L", "R", "F", "B"];
  var modifiers = ["", "'", "2"];
  var scrambleSequence = [];
  var lastFace = -1;

  for (var i = 0; i < 25; i++) {
    var face_idx;
    do {
        face_idx = Math.floor(Math.random() * faces.length);
    } while(face_idx === lastFace);
    lastFace = face_idx;
    
    var mod_idx = Math.floor(Math.random() * modifiers.length);
    scrambleSequence.push(faces[face_idx] + modifiers[mod_idx]);
  }
  performMoves(scrambleSequence.join(' '));
}

// --- Event Listeners ---
document.getElementById('scramble-btn').addEventListener('click', scrambleCube);
document.getElementById('reset-btn').addEventListener('click', resetCube);

</script>
</body>
</html>
